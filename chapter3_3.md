<script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.min.js">
</script>
<script type="text/x-mathjax-config">
 MathJax.Hub.Config({
 tex2jax: {
 inlineMath: [['$', '$'] ],
 displayMath: [ ['$$','$$'], ["\\[","\\]"] ]
 }
 });
</script>

# 3.3 データ処理と特徴量エンジニアリング

## 特徴量エンジニアリングとは

- 予測変数として採用する列の選別
- データに前処理を施し、予測に効果的な形に加工する

## 文字列データを数値データに変換

- **カテゴリカルデータ** カテゴリを区別するために用いられるデータ。カテゴリカルデータは質的変数。数値で表現することもあるが、意味を持たないダミー数値。
- **One-hotエンコーディング** カテゴリ毎に列をつくり、１つの列項目だけを１、それ以外を０にする。スパースな行列になりやすい。列が増えすぎると特徴量として扱いにくい場合もある。（列の数＝特徴量の数が多くなり、過学習しやすくなる）
- **ラベルエンコーディング** １つのカテゴリが１つの数値に対応するように数字に置き換える。

## データ欠損の処理

- **リストワイズ法** 欠損値があるサンプルをそのまま削除する方法
- **回帰補完** 欠損列と非欠損列の間に相関が強い場合、回帰を利用して欠損値を埋める方法
- **統計量で補完** 欠損部分が全体に影響しないよう、平均値、中央値、最頻値などの統計量で埋める方法

## 数値データが抱える問題

- 変数間にスケールが異なる
- 変数間で何等かの関係（依存関係や因果関係など）が存在する
- 分布に偏りがある
- 外れ値や異常値を含む

分析結果への影響は、分析手法やモデルの種類によって異なる。SVMやK近傍法は外れ値の影響を受けやすいが、決定木やアンサンブル学習器は外れ値に比較的頑丈。


## 対数変換、正規化と標準化

- **対数変換** 対数変換は、偏りのある裾の長い分布をしたデータを正規表現に近づけるために有効
- **正規化**(**Normalization**) 最小値が0、最大値が1の無次元の量になるようにデータを変換する
- **標準化**(**Standarization**) 平均が0、分散が1の無次元の量になるようにデータを変換する

正規化と標準化の効果
- スケールが揃うことで比較しやすくなる
- モデルの学習がより高速かつ高精度になる

### 正規化

正規化は、0-1正規化などとも呼ばれる。以下の式で変換する。

$$\frac{データの値 - 最小値}{最大値-最小値}$$

注意点として、正規化は**外れ値に敏感に反応してしまう**という特徴がある。極端に小さい値または大きい値がデータに含まれている場合、変換後のデータも偏ってしまう。

### 標準化

各データから平均値を引いて標準偏差で割ることで標準化する。

$$\hat{x}_i = \frac{x_i - \mu}{\sigma}$$

機械学習を用いた予測モデルを作る際、特徴量に標準化を適用することが推奨されている。

標準化は**外れ値に頑丈**である。

### 使い分け

- 正規化の方が計算コストが低い。最大や最小がわかっている場合は正規化が使われることもある。<br>
大量なデータに対して高速に演算を繰り返す必要のある画像処理が代表例
- データに外れ地がある場合、標準化の方が適している。データの最大値や最小値が未知である場合も標準化が使われる。

## 量的変数の離散化

**離散化**とは、**量的変数を質的変数に変換すること**。離散化によって、データの特徴を強く反映する特徴量に変換でき、以下のような効果が期待できる。

- データのスケールを揃える
- データの変動による影響を緩和する
- 結果の解釈が簡単になる

**固定幅による離散化**がシンプル（年齢データを10歳区間で区切る）。
