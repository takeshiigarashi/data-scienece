<script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.min.js">
</script>
<script type="text/x-mathjax-config">
 MathJax.Hub.Config({
 tex2jax: {
 inlineMath: [['$', '$'] ],
 displayMath: [ ['$$','$$'], ["\\[","\\]"] ]
 }
 });
</script>

# 時系列分析

## 時系列データ分析の活用

- 時間とともに変化するデータ
- 一定の間隔で取得したデータ
- 連続的に記録するものもあれば、離散的に記録するものもある

例

- 音声、動画
- 各種センサーの測定値
- 気温や降水量などの気象データ
- 売上推移、株価変動

時系列データ分析の例

- 需要予測
- 異常検知
- 文章生成

## 時系列データの構成成分

大きく分けて、**ノイズ**、**周期性**、**トレンド**の３種類

**ノイズ** 一般的に、分析によって抽出したい情報と関連しない不要な情報をノイズという。

時系列データ分析では、解析の目的によってどのような成分がノイズに該当するかが変わる。長期的な傾向を知りたいときは、短期的な変動がノイズになりうる。ノイズの影響を減らすために、移動平均がよく使われる。短期的な変動のパターンを捉えたいときは、長期的な傾向をノイズとして除くことになる。

**トレンド** 一般的に、細かな変動やノイズを除いた、長期にわたって持続的にヘナkする、なだらかな傾向を指す。一般には、季節性の周期性の変動よりも周期が長いのが特徴。

**周期性・季節変動** 周期性とは、一定期間ごとに繰り返される変動パターンのこと。

**循環変動** 周期的に繰り返されるが、周期が一定ではないものを言う。例えば、景気指数変動は好況、不況の繰り返しだが、周期は一定ではない。

**短期的な変動と差分系列** 時系列データから周期性やトレンドを除いた後に残る局所的で細かい変動が**短期的変動**。時系列データを**差分系列**（ある時刻と１つ前の時刻のデータの差分、階差）に変換することで、長期的な変動が除去され、局所的な変動成分を抽出することができる。差分系列をとると、急激な変動による外れ値をみつけるのにも有効。

## 移動平均系列

**移動平均（Moving Average）** は、区間を移動しながら一定区間ごとに平均値を計算して得られる系列。**平滑化**や**スムージング**とも呼ばれる。

- 移動平均から得られる移動平均系列は、長期的なトレンドを見やすくできる
- 区間の幅を**ウィンドウ**や**ウィンドウサイズ**と呼ばれる。ウィンドウサイズを広く取りすぎると、本当に捉えたい傾向まで平坦にしてしまうため注意が必要。
- **単純移動平均**と呼ばれるものは以下の種類がある
  - 中央移動平均: 該当時刻とその前後の時刻を使う
  - 後方移動平均: 該当時刻とそれ以前の時刻を使う（tとt-1で平均を取る）
  - 前方移動平均: 該当時刻とそれ以降の時刻を使う（tとt+1で平均を取る）
- 遠い過去よりも直近の値に比重を置く**指数平滑移動平均**もある

## 定常性と自己相関

**定常性** 時系列における**定常性**とは、**平均と自己共分散が時間の経過とともに一定である**という性質。定常性を持たない系列は、非定常仮定に従う系列という。

時系列分析モデルによっては定常性のデータに対して使用可能であるため、定常性を満たすようにデータを変換（差分変換や対数差分変換）することがある。

**自己相関**: **事例列データのある時刻の値と、その時刻から一定時間ずらした時刻の値の間に相関関係がある**ことをいう。

## 精度評価の注意点

機械学習の精度評価では、学習データを訓練データとテストデータに分割して評価するが、**時系列分析の場合、データをランダムに分割すると精度を正しく評価できないことに注意が必要**。

時系列データ分析では、過去のデータを用いて未来のデータを予測するため、訓練データとテストデータを分割するときも、過去のデータと未来のデータになるよう分割する必要がある。

## 時系列分析の具体的な手法

４つの手法を紹介

- **MA（移動平均, Moving Average）**
- **AR（自己回帰, Auto Regressive）モデル**
- **ARMA（自己回帰移動平均, AutoRegressive Moving Average）モデル**
- **ARIMA（自己回帰和分移動平均, AutoRegressive Integrated Moving Average）モデル**

**MA（移動平均, Moving Average）**: 移動平均モデルは、現在の値を、過去のホワイトノイズ項（ランダム誤差）の線形結合として表現するモデル。

一次MAモデル MA(1) では、以下の式になる。

$y_t = c + r_t + \theta_1r_{t-1}$

$r_t$は、時点tにおいて発生するホワイトノイズ（ランダムな誤差情報）を表す。

時点tにおける値$y_t$は、時点tにおけるホワイトノイズ$r_t$と、１時刻前のホワイトノイズ$r_{t_1}$から算出される、という式になっている。パラメータ$\theta_1$は、１時刻前のノイズの影響を受ける程度。$c$は定数項となっている。

１次MAモデル MA(1)は、「現在の時刻は１つ前の時刻での誤差の影響を受ける」というモデルである。

q次MAモデル MA(q)は、「現在の時刻はq時点前以降の誤差の影響を受ける」というモデルで、以下の式で表される。

$y_t = c + r_t + \sum_{i=1}^q \theta_ir_{t-i}$

この式は、過去の各時刻でのホワイトノイズをパラメータ$\theta_i$で重み付けした和が現在の値に影響を与えていると会社kうできる。

**AR（自己回帰, Auto Regressive）モデル**: 自己回帰モデルは、一定期間に遡る過去の自分のデータの線形結合で表される。過去のデータに対して回帰を行うことで現在の値を予測する。

１次ARモデルAR(1)の式は次のようになる。

$y_t = c_0 + c_1y_{t-1} + r_t$

ここで$r_t$はホワイトノイズを表している。

c_0とc_1は、通常の回帰分析と同様に最小二乗法で求めることができる。

q次ARモデル AR(q)は以下になる。

$r_t = c_0 + \sum_{i=1}^q c_iy_{t-i} + r_t$

**ARMA（自己回帰移動平均, AutoRegressive Moving Average）モデル**: ARとMAを組み合わせたモデル。

p次ARモデルとq次MAモデルを組み合わせたARMAを、ARMA(p,q)モデルと記述することが多い。ARMA(p,q)の式は次のようになる。

$y_t = c + r_t + \sum_{i=1}^p c_ty_{t-i} + \sum_{i=i}^q \theta_ir_{t-i}$

**ARIMA（自己回帰和分移動平均, AutoRegressive Integrated Moving Average）モデル**: ARMAに和分モデルを加えたモデル。

和分は、時系列データの階差を何回取れば定常になるかを意味する。時系列データが非定常な場合、ARMAモデルは適用できない。ARIMAモデルでは、差分を取ることによって定常過程に変換し、ARMAモデルを適用可能な形に変換する。

**SARIMAモデル**: ARIMAの発展版に **SRIMAモデル（季節変動自己回帰和分移動平均モデル, Seasonal AutoRegressive Integrated Moving Average）** がある。ARIMAに季節性の周期変動を加えたモデルになっている。SARIMAでは、データを季節周期に分割し、その差分を取り、そのデータに対してARMAモデルを適用する。

